define(["underscore","backbone","templateregistry","i18next"],function(e,t,n,r){var i=t.View.extend({channel:null,subscriptions:[],initialize:function(){if(!this.template&&(!this.options.template||!e.isString(this.options.template)))throw new Error("All views must specify their template at creation");this.template=this.template?this.template:this.options.template,this.channel=this.options.channel,e.bindAll(this,"render","afterRender");var t=this;this.render=e.wrap(this.render,function(e){return t.beforeRender(),e(),t.afterRender(),t})},render:function(){var e=this.options.data,t;this.model&&(e=this.model.toJSON()),this.template in n?(t=n[this.template],this.$el.html(t(e))):this.$el.html(this.template)},load:function(){this.model?(this.loadRender(),this.model.fetch().done(e.bind(this.render,this)).fail(e.bind(this.errorHandler,this))):this.render()},loadRender:function(){this.$el.html('<div class="loading"><p>Loading view..</p><div>')},defaultAction:function(){this.render()},errorHandler:function(){},beforeRender:function(){},afterRender:function(){},subscribe:function(e,t){var n=this.channel.subscribe(e,t);this.subscriptions.push(n)},publish:function(e,t){this.channel.publish(e,t)},unsubscribeAll:function(){e.each(this.subscriptions,function(e){e.unsubscribe()})},dispose:function(){this.$el.empty(),this.model&&this.model.off(),this.unsubscribeAll()}});return i});